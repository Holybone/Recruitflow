<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecruitFlow ATS - Ultimate Edition</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@6/dist/email.min.js"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        @media print { .no-print { display: none !important; } }
        .dark-mode { background: #1a202c; color: #e2e8f0; }
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .gradient-text { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .status-card { 
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .status-card:hover { 
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        @media (max-width: 640px) {
            .mobile-menu { display: flex; flex-direction: column; }
            .desktop-only { display: none; }
        }
        @media (min-width: 641px) and (max-width: 1024px) {
            .tablet-adjust { padding: 1rem; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Enhanced Icons
        const BriefcaseIcon = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>;
        const SparklesIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>;
        const MailIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>;
        const VideoIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>;
        const ChartIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>;
        const FilterIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" /></svg>;
        const MenuIcon = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>;
        const TrendUpIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>;
        const ClockIcon = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
        const StarIcon = () => <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" /></svg>;

        function App() {
            const [view, setView] = useState('dashboard');
            const [jobs, setJobs] = useState([]);
            const [candidates, setCandidates] = useState([]);
            const [emails, setEmails] = useState([]);
            const [videoInterviews, setVideoInterviews] = useState([]);
            const [apiKey, setApiKey] = useState('');
            const [emailJsConfig, setEmailJsConfig] = useState({
                serviceId: '',
                templateId: '',
                publicKey: ''
            });
            const [aiEnabled, setAiEnabled] = useState(false);
            const [emailEnabled, setEmailEnabled] = useState(false);
            const [parseMode, setParseMode] = useState('free');
            const [branding, setBranding] = useState({ 
                name: 'RecruitFlow ATS', 
                primaryColor: 'blue',
                currency: '‚Ç¶' 
            });
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [emailFilter, setEmailFilter] = useState('all'); // all, unread, priority
            const [emailSort, setEmailSort] = useState('time'); // time, priority, candidate
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            // NAIRA PRICING
            const PRICING = {
                FREE: { amount: 0, jobs: 1, candidates: 25 },
                STARTER: { amount: 11600, jobs: 5, candidates: 100 },
                PROFESSIONAL: { amount: 31600, jobs: 20, candidates: 500 },
                ENTERPRISE: { amount: 79600, jobs: -1, candidates: -1 }
            };

            // Load data
            useEffect(() => {
                const loadData = () => {
                    try {
                        const saved = {
                            jobs: localStorage.getItem('ats_jobs'),
                            candidates: localStorage.getItem('ats_candidates'),
                            emails: localStorage.getItem('ats_emails'),
                            apiKey: localStorage.getItem('ats_apiKey'),
                            emailConfig: localStorage.getItem('ats_emailConfig'),
                            branding: localStorage.getItem('ats_branding'),
                            videos: localStorage.getItem('ats_videos')
                        };
                        
                        if (saved.jobs) setJobs(JSON.parse(saved.jobs));
                        if (saved.candidates) setCandidates(JSON.parse(saved.candidates));
                        if (saved.emails) setEmails(JSON.parse(saved.emails));
                        if (saved.videos) setVideoInterviews(JSON.parse(saved.videos));
                        if (saved.apiKey) {
                            setApiKey(saved.apiKey);
                            setAiEnabled(true);
                        }
                        if (saved.emailConfig) {
                            const config = JSON.parse(saved.emailConfig);
                            setEmailJsConfig(config);
                            if (config.serviceId && config.publicKey) {
                                setEmailEnabled(true);
                                // Initialize EmailJS v6
                                emailjs.init({
                                    publicKey: config.publicKey
                                });
                            }
                        }
                        if (saved.branding) setBranding(JSON.parse(saved.branding));
                    } catch (error) {
                        console.error('Error loading data:', error);
                    }
                };
                loadData();
            }, []);

            // Save data
            useEffect(() => { localStorage.setItem('ats_jobs', JSON.stringify(jobs)); }, [jobs]);
            useEffect(() => { localStorage.setItem('ats_candidates', JSON.stringify(candidates)); }, [candidates]);
            useEffect(() => { localStorage.setItem('ats_emails', JSON.stringify(emails)); }, [emails]);
            useEffect(() => { localStorage.setItem('ats_videos', JSON.stringify(videoInterviews)); }, [videoInterviews]);
            useEffect(() => { localStorage.setItem('ats_branding', JSON.stringify(branding)); }, [branding]);

            // Enhanced Dashboard with Charts
            useEffect(() => {
                if (view === 'dashboard' && chartRef.current && candidates.length > 0) {
                    const ctx = chartRef.current.getContext('2d');
                    
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }

                    const statusCounts = {
                        new: candidates.filter(c => c.status === 'new').length,
                        screening: candidates.filter(c => c.status === 'screening').length,
                        interview: candidates.filter(c => c.status === 'interview').length,
                        offer: candidates.filter(c => c.status === 'offer').length,
                        rejected: candidates.filter(c => c.status === 'rejected').length
                    };

                    chartInstance.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['New', 'Screening', 'Interview', 'Offer', 'Rejected'],
                            datasets: [{
                                label: 'Candidates by Status',
                                data: Object.values(statusCounts),
                                backgroundColor: [
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(251, 191, 36, 0.8)',
                                    'rgba(168, 85, 247, 0.8)',
                                    'rgba(34, 197, 94, 0.8)',
                                    'rgba(239, 68, 68, 0.8)'
                                ],
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                }

                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [view, candidates]);

            // Email sending function
            const sendEmail = async (to, subject, body, candidateId) => {
                if (!emailEnabled) {
                    alert('Email not configured. Please setup EmailJS in Settings.');
                    return false;
                }

                try {
                    const templateParams = {
                        to_email: to,
                        subject: subject,
                        message: body,
                        from_name: branding.name
                    };

                    // EmailJS v6 syntax
                    await emailjs.send(
                        emailJsConfig.serviceId,
                        emailJsConfig.templateId,
                        templateParams
                    );

                    // Log email
                    const newEmail = {
                        id: Date.now(),
                        to,
                        subject,
                        body,
                        candidateId,
                        sentAt: new Date().toISOString(),
                        status: 'sent',
                        read: false,
                        priority: calculateEmailPriority(candidateId)
                    };
                    setEmails([...emails, newEmail]);
                    
                    return true;
                } catch (error) {
                    console.error('Email send error:', error);
                    alert('Failed to send email: ' + error.text);
                    return false;
                }
            };

            // Calculate email priority based on candidate score
            const calculateEmailPriority = (candidateId) => {
                const candidate = candidates.find(c => c.id === candidateId);
                if (!candidate) return 'normal';
                if (candidate.score >= 80) return 'high';
                if (candidate.score >= 60) return 'medium';
                return 'normal';
            };

            // Sort emails
            const sortedEmails = [...emails].sort((a, b) => {
                if (emailSort === 'time') {
                    return new Date(b.sentAt) - new Date(a.sentAt);
                } else if (emailSort === 'priority') {
                    const priorityOrder = { high: 3, medium: 2, normal: 1 };
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                } else if (emailSort === 'candidate') {
                    const candA = candidates.find(c => c.id === a.candidateId);
                    const candB = candidates.find(c => c.id === b.candidateId);
                    return (candB?.score || 0) - (candA?.score || 0);
                }
                return 0;
            });

            // Filter emails
            const filteredEmails = sortedEmails.filter(email => {
                if (emailFilter === 'unread') return !email.read;
                if (emailFilter === 'priority') return email.priority === 'high';
                return true;
            });

            // Resume parsing (simplified for space)
            const parsePDF = async (file) => {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                let text = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(item => item.str).join(' ') + '\n';
                }
                return text;
            };

            const extractDataFree = (text) => {
                return {
                    name: text.match(/^([A-Z][a-z]+\s+[A-Z][a-z]+)/m)?.[1] || '',
                    email: text.match(/[\w\.-]+@[\w\.-]+\.\w+/)?.[0] || '',
                    phone: text.match(/(\+?\d{1,3}[-.\s]?)?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}/)?.[0] || '',
                    skills: ['javascript', 'react', 'python', 'node', 'java', 'sql', 'aws', 'docker']
                        .filter(skill => text.toLowerCase().includes(skill)),
                    experience: parseInt(text.match(/(\d+)\+?\s*years?\s*(of)?\s*experience/i)?.[1] || '0')
                };
            };

            const handleResumeUpload = async (file) => {
                if (!file) return null;
                try {
                    const text = await parsePDF(file);
                    return parseMode === 'ai' && aiEnabled
                        ? await extractDataAI(text)
                        : extractDataFree(text);
                } catch (error) {
                    console.error('Parse error:', error);
                    return null;
                }
            };

            const extractDataAI = async (text) => {
                if (!apiKey) return null;
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [{
                                role: 'user',
                                content: `Extract: name, email, phone, skills (array), experience (years). JSON only:\n${text.substring(0, 3000)}`
                            }],
                            temperature: 0.3
                        })
                    });
                    const result = await response.json();
                    return JSON.parse(result.choices[0].message.content.match(/\{[\s\S]*\}/)[0]);
                } catch (error) {
                    return null;
                }
            };

            // Enhanced Dashboard
            const EnhancedDashboard = () => {
                const avgScore = candidates.length > 0
                    ? Math.round(candidates.reduce((sum, c) => sum + c.score, 0) / candidates.length)
                    : 0;

                const timeToHire = candidates.filter(c => c.status === 'offer').length > 0
                    ? Math.round(Math.random() * 15 + 10) // Simulated
                    : 0;

                const conversionRate = candidates.length > 0
                    ? Math.round((candidates.filter(c => c.status === 'offer').length / candidates.length) * 100)
                    : 0;

                return (
                    <div className="space-y-6">
                        {/* Status Banner */}
                        <div className={`p-4 rounded-xl ${aiEnabled ? 'bg-gradient-to-r from-purple-100 to-pink-100' : 'bg-blue-50'} border ${aiEnabled ? 'border-purple-200' : 'border-blue-200'}`}>
                            <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                                <div className="flex items-center gap-3">
                                    {aiEnabled ? <SparklesIcon /> : <BriefcaseIcon />}
                                    <div>
                                        <p className="font-semibold">{aiEnabled ? 'üöÄ AI Parser Active' : '‚ö° Free Parser Active'}</p>
                                        <p className="text-sm text-gray-700">
                                            {aiEnabled ? 'Smart parsing ‚Ä¢ ~‚Ç¶0.12 per resume' : 'Basic parsing ‚Ä¢ Free forever'}
                                        </p>
                                    </div>
                                </div>
                                {!aiEnabled && (
                                    <button onClick={() => setView('settings')} className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm font-semibold whitespace-nowrap">
                                        Enable AI
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* Key Metrics */}
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div className="status-card bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg">
                                <div className="flex items-center justify-between mb-2">
                                    <p className="text-blue-100 text-sm">Active Jobs</p>
                                    <BriefcaseIcon />
                                </div>
                                <p className="text-4xl font-bold">{jobs.filter(j => j.status === 'active').length}</p>
                                <p className="text-blue-100 text-xs mt-2 flex items-center gap-1">
                                    <TrendUpIcon className="w-4 h-4" /> {candidates.length} applicants
                                </p>
                            </div>

                            <div className="status-card bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg">
                                <div className="flex items-center justify-between mb-2">
                                    <p className="text-green-100 text-sm">Avg Match Score</p>
                                    <StarIcon />
                                </div>
                                <p className="text-4xl font-bold">{avgScore}%</p>
                                <p className="text-green-100 text-xs mt-2">Quality indicator</p>
                            </div>

                            <div className="status-card bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-lg">
                                <div className="flex items-center justify-between mb-2">
                                    <p className="text-purple-100 text-sm">Time to Hire</p>
                                    <ClockIcon />
                                </div>
                                <p className="text-4xl font-bold">{timeToHire}</p>
                                <p className="text-purple-100 text-xs mt-2">days average</p>
                            </div>

                            <div className="status-card bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-xl shadow-lg">
                                <div className="flex items-center justify-between mb-2">
                                    <p className="text-orange-100 text-sm">Conversion Rate</p>
                                    <ChartIcon />
                                </div>
                                <p className="text-4xl font-bold">{conversionRate}%</p>
                                <p className="text-orange-100 text-xs mt-2">Applicant to offer</p>
                            </div>
                        </div>

                        {/* Charts */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                                    <ChartIcon /> Pipeline Status
                                </h3>
                                <div className="h-64">
                                    <canvas ref={chartRef}></canvas>
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-lg font-bold mb-4">Recent Activity</h3>
                                <div className="space-y-3">
                                    {candidates.slice(0, 5).map(c => (
                                        <div key={c.id} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition cursor-pointer">
                                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-bold">
                                                {c.name.charAt(0)}
                                            </div>
                                            <div className="flex-1">
                                                <p className="font-semibold text-sm">{c.name}</p>
                                                <p className="text-xs text-gray-600">{jobs.find(j => j.id === c.jobId)?.title}</p>
                                            </div>
                                            <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                                c.status === 'new' ? 'bg-blue-100 text-blue-800' :
                                                c.status === 'interview' ? 'bg-purple-100 text-purple-800' :
                                                'bg-green-100 text-green-800'
                                            }`}>
                                                {c.score}%
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Parsing Stats */}
                        {candidates.length > 0 && (
                            <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl shadow-lg p-6 border border-blue-100">
                                <h3 className="text-lg font-bold mb-4">Parsing Performance</h3>
                                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div className="text-center">
                                        <p className="text-3xl font-bold text-blue-600">
                                            {candidates.filter(c => c.parsedWith === 'free').length}
                                        </p>
                                        <p className="text-sm text-gray-600 mt-1">Free Parser</p>
                                        <p className="text-xs text-gray-500">‚Ç¶0.00</p>
                                    </div>
                                    <div className="text-center">
                                        <p className="text-3xl font-bold text-purple-600">
                                            {candidates.filter(c => c.parsedWith === 'ai').length}
                                        </p>
                                        <p className="text-sm text-gray-600 mt-1">AI Parser</p>
                                        <p className="text-xs text-gray-500">
                                            ‚Ç¶{(candidates.filter(c => c.parsedWith === 'ai').length * 0.12).toFixed(2)}
                                        </p>
                                    </div>
                                    <div className="text-center">
                                        <p className="text-3xl font-bold text-green-600">{avgScore}%</p>
                                        <p className="text-sm text-gray-600 mt-1">Avg Accuracy</p>
                                        <p className="text-xs text-gray-500">Match quality</p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Email Management View
            const EmailManagement = () => (
                <div>
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                        <h2 className="text-2xl font-bold">Email Management</h2>
                        <div className="flex flex-wrap gap-2">
                            <select
                                value={emailFilter}
                                onChange={(e) => setEmailFilter(e.target.value)}
                                className="px-4 py-2 border rounded-lg text-sm"
                            >
                                <option value="all">All Emails</option>
                                <option value="unread">Unread</option>
                                <option value="priority">High Priority</option>
                            </select>
                            <select
                                value={emailSort}
                                onChange={(e) => setEmailSort(e.target.value)}
                                className="px-4 py-2 border rounded-lg text-sm"
                            >
                                <option value="time">Sort by Time</option>
                                <option value="priority">Sort by Priority</option>
                                <option value="candidate">Sort by Value</option>
                            </select>
                            <button
                                onClick={() => setView('settings')}
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-semibold whitespace-nowrap"
                            >
                                Configure Email
                            </button>
                        </div>
                    </div>

                    {!emailEnabled && (
                        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6">
                            <h3 className="font-semibold text-yellow-900 mb-2">‚ö†Ô∏è Email Not Configured</h3>
                            <p className="text-yellow-800 text-sm mb-3">
                                Set up EmailJS to send automated emails to candidates. It's free for up to 200 emails/month!
                            </p>
                            <button
                                onClick={() => setView('settings')}
                                className="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 text-sm font-semibold"
                            >
                                Setup Now
                            </button>
                        </div>
                    )}

                    <div className="bg-white rounded-lg shadow overflow-hidden">
                        {filteredEmails.length === 0 ? (
                            <div className="text-center py-12">
                                <MailIcon className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                <p className="text-gray-500">No emails yet</p>
                                <p className="text-sm text-gray-400 mt-1">Send your first email to a candidate</p>
                            </div>
                        ) : (
                            <div className="divide-y">
                                {filteredEmails.map(email => {
                                    const candidate = candidates.find(c => c.id === email.candidateId);
                                    return (
                                        <div
                                            key={email.id}
                                            className={`p-4 hover:bg-gray-50 transition cursor-pointer ${!email.read ? 'bg-blue-50' : ''}`}
                                            onClick={() => {
                                                const updated = emails.map(e => 
                                                    e.id === email.id ? {...e, read: true} : e
                                                );
                                                setEmails(updated);
                                            }}
                                        >
                                            <div className="flex items-start justify-between gap-4">
                                                <div className="flex-1 min-w-0">
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <span className={`font-semibold truncate ${!email.read ? 'text-blue-900' : 'text-gray-900'}`}>
                                                            {email.to}
                                                        </span>
                                                        {email.priority === 'high' && (
                                                            <span className="px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded-full flex items-center gap-1 whitespace-nowrap">
                                                                <StarIcon className="w-3 h-3" /> High Value
                                                            </span>
                                                        )}
                                                        {!email.read && (
                                                            <span className="w-2 h-2 bg-blue-600 rounded-full"></span>
                                                        )}
                                                    </div>
                                                    <p className={`text-sm mb-1 ${!email.read ? 'font-semibold' : 'text-gray-700'}`}>
                                                        {email.subject}
                                                    </p>
                                                    <p className="text-xs text-gray-500 truncate">{email.body}</p>
                                                    {candidate && (
                                                        <p className="text-xs text-gray-400 mt-1">
                                                            Candidate: {candidate.name} ‚Ä¢ Score: {candidate.score}%
                                                        </p>
                                                    )}
                                                </div>
                                                <div className="text-right flex-shrink-0">
                                                    <p className="text-xs text-gray-500 whitespace-nowrap">
                                                        {new Date(email.sentAt).toLocaleDateString()}
                                                    </p>
                                                    <p className="text-xs text-gray-400">
                                                        {new Date(email.sentAt).toLocaleTimeString()}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>

                    {/* Email Stats */}
                    {emails.length > 0 && (
                        <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-6">
                            <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-4 rounded-lg">
                                <p className="text-blue-100 text-sm">Total Sent</p>
                                <p className="text-3xl font-bold">{emails.length}</p>
                            </div>
                            <div className="bg-gradient-to-br from-green-500 to-green-600 text-white p-4 rounded-lg">
                                <p className="text-green-100 text-sm">High Priority</p>
                                <p className="text-3xl font-bold">{emails.filter(e => e.priority === 'high').length}</p>
                            </div>
                            <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-4 rounded-lg">
                                <p className="text-purple-100 text-sm">Unread</p>
                                <p className="text-3xl font-bold">{emails.filter(e => !e.read).length}</p>
                            </div>
                        </div>
                    )}
                </div>
            );

            // Video Interview View
            const VideoInterviewView = () => (
                <div>
                    <h2 className="text-2xl font-bold mb-6">Video Interviews</h2>
                    
                    <div className="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-6 mb-6">
                        <h3 className="font-semibold text-purple-900 mb-2 flex items-center gap-2">
                            <VideoIcon /> One-Way Video Interview System
                        </h3>
                        <p className="text-purple-800 text-sm mb-4">
                            Candidates record video responses to preset questions. Review at your convenience and share with your team.
                        </p>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="bg-white p-4 rounded-lg">
                                <h4 className="font-semibold text-gray-900 mb-2">For Candidates:</h4>
                                <ul className="text-sm text-gray-700 space-y-1">
                                    <li>‚úì Record on their own time</li>
                                    <li>‚úì No scheduling conflicts</li>
                                    <li>‚úì Review before submitting</li>
                                    <li>‚úì Works on any device</li>
                                </ul>
                            </div>
                            <div className="bg-white p-4 rounded-lg">
                                <h4 className="font-semibold text-gray-900 mb-2">For You:</h4>
                                <ul className="text-sm text-gray-700 space-y-1">
                                    <li>‚úì Review anytime, anywhere</li>
                                    <li>‚úì Compare candidates fairly</li>
                                    <li>‚úì Share with team</li>
                                    <li>‚úì Save time on screening</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow p-6">
                        <h3 className="text-lg font-bold mb-4">Video Submissions</h3>
                        {videoInterviews.length === 0 ? (
                            <div className="text-center py-8">
                                <VideoIcon className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                <p className="text-gray-500">No video interviews yet</p>
                                <p className="text-sm text-gray-400 mt-1">Candidates will submit videos through the application form</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {videoInterviews.map(video => {
                                    const candidate = candidates.find(c => c.id === video.candidateId);
                                    return (
                                        <div key={video.id} className="border rounded-lg p-4 hover:shadow-lg transition">
                                            <div className="aspect-video bg-gray-900 rounded-lg mb-3 flex items-center justify-center">
                                                <VideoIcon className="w-12 h-12 text-white opacity-50" />
                                            </div>
                                            <h4 className="font-semibold">{candidate?.name}</h4>
                                            <p className="text-sm text-gray-600">{candidate?.email}</p>
                                            <p className="text-xs text-gray-500 mt-2">
                                                Submitted: {new Date(video.submittedAt).toLocaleDateString()}
                                            </p>
                                            <button className="mt-3 w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm font-semibold">
                                                Watch Video
                                            </button>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>

                    {/* Integration Instructions */}
                    <div className="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h3 className="font-semibold text-blue-900 mb-2">üìπ Video Recording Integration</h3>
                        <p className="text-blue-800 text-sm mb-3">
                            To enable video recording, integrate with one of these services:
                        </p>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="bg-white p-3 rounded">
                                <p className="font-semibold text-sm">RecordRTC (Free)</p>
                                <p className="text-xs text-gray-600">Browser-based recording</p>
                            </div>
                            <div className="bg-white p-3 rounded">
                                <p className="font-semibold text-sm">Ziggeo ($)</p>
                                <p className="text-xs text-gray-600">Professional video API</p>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Settings with Email Configuration
            const SettingsView = () => {
                const [tempApiKey, setTempApiKey] = useState(apiKey);
                const [tempEmailConfig, setTempEmailConfig] = useState(emailJsConfig);

                const testEmailConfig = async () => {
                    if (!tempEmailConfig.serviceId || !tempEmailConfig.publicKey || !tempEmailConfig.templateId) {
                        alert('Please fill in all EmailJS configuration fields');
                        return;
                    }

                    try {
                        // Initialize with v6 syntax
                        emailjs.init({
                            publicKey: tempEmailConfig.publicKey
                        });
                        
                        // Test send with v6 syntax
                        await emailjs.send(
                            tempEmailConfig.serviceId,
                            tempEmailConfig.templateId,
                            {
                                to_email: 'test@example.com',
                                subject: 'Test Email',
                                message: 'This is a test from RecruitFlow ATS',
                                from_name: branding.name
                            }
                        );

                        setEmailJsConfig(tempEmailConfig);
                        localStorage.setItem('ats_emailConfig', JSON.stringify(tempEmailConfig));
                        setEmailEnabled(true);
                        alert('‚úÖ Email configuration successful! You can now send emails.');
                    } catch (error) {
                        alert('‚ùå Email test failed: ' + error.text);
                    }
                };

                return (
                    <div className="space-y-6">
                        <h2 className="text-2xl font-bold">Settings</h2>

                        {/* AI Configuration */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                                <SparklesIcon /> AI Parser Configuration
                            </h3>
                            {aiEnabled ? (
                                <div className="bg-green-50 p-4 rounded-lg border border-green-200 mb-4">
                                    <p className="text-green-800 font-semibold">‚úÖ AI Parser Active</p>
                                    <p className="text-sm text-green-700 mt-1">Using OpenAI GPT-4o-mini (~‚Ç¶0.12 per resume)</p>
                                </div>
                            ) : (
                                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4">
                                    <p className="text-yellow-800">‚ö†Ô∏è Currently using free parser</p>
                                </div>
                            )}
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-semibold mb-2">OpenAI API Key</label>
                                    <input
                                        type="password"
                                        value={tempApiKey}
                                        onChange={(e) => setTempApiKey(e.target.value)}
                                        placeholder="sk-..."
                                        className="w-full px-4 py-2 border rounded-lg"
                                    />
                                    <p className="text-xs text-gray-500 mt-1">
                                        Get from <a href="https://platform.openai.com/api-keys" target="_blank" className="text-blue-600 hover:underline">platform.openai.com</a>
                                    </p>
                                </div>
                                <button
                                    onClick={() => {
                                        if (tempApiKey) {
                                            setApiKey(tempApiKey);
                                            localStorage.setItem('ats_apiKey', tempApiKey);
                                            setAiEnabled(true);
                                            alert('‚úÖ API key saved! AI parser enabled.');
                                        }
                                    }}
                                    className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700"
                                >
                                    Save API Key
                                </button>
                            </div>
                        </div>

                        {/* Email Configuration */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                                <MailIcon /> Email Configuration (EmailJS)
                            </h3>
                            {emailEnabled ? (
                                <div className="bg-green-50 p-4 rounded-lg border border-green-200 mb-4">
                                    <p className="text-green-800 font-semibold">‚úÖ Email Active</p>
                                    <p className="text-sm text-green-700 mt-1">Ready to send automated emails</p>
                                </div>
                            ) : (
                                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4">
                                    <p className="text-yellow-800">‚ö†Ô∏è Email not configured</p>
                                </div>
                            )}
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-semibold mb-2">Service ID</label>
                                    <input
                                        type="text"
                                        value={tempEmailConfig.serviceId}
                                        onChange={(e) => setTempEmailConfig({...tempEmailConfig, serviceId: e.target.value})}
                                        placeholder="service_xxxxxxx"
                                        className="w-full px-4 py-2 border rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold mb-2">Template ID</label>
                                    <input
                                        type="text"
                                        value={tempEmailConfig.templateId}
                                        onChange={(e) => setTempEmailConfig({...tempEmailConfig, templateId: e.target.value})}
                                        placeholder="template_xxxxxxx"
                                        className="w-full px-4 py-2 border rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold mb-2">Public Key</label>
                                    <input
                                        type="text"
                                        value={tempEmailConfig.publicKey}
                                        onChange={(e) => setTempEmailConfig({...tempEmailConfig, publicKey: e.target.value})}
                                        placeholder="xxxxxxxxxxxxxxx"
                                        className="w-full px-4 py-2 border rounded-lg"
                                    />
                                </div>
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <p className="text-sm text-blue-800 mb-2">
                                        üìß Get these from <a href="https://www.emailjs.com" target="_blank" className="font-semibold hover:underline">emailjs.com</a>
                                    </p>
                                    <p className="text-xs text-blue-700">Free tier: 200 emails/month</p>
                                </div>
                                <button
                                    onClick={testEmailConfig}
                                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
                                >
                                    Test & Save Email Config
                                </button>
                            </div>
                        </div>

                        {/* Branding */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-xl font-bold mb-4">Branding & Currency</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-semibold mb-2">Company Name</label>
                                    <input
                                        type="text"
                                        value={branding.name}
                                        onChange={(e) => setBranding({...branding, name: e.target.value})}
                                        className="w-full px-4 py-2 border rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold mb-2">Primary Color</label>
                                    <select
                                        value={branding.primaryColor}
                                        onChange={(e) => setBranding({...branding, primaryColor: e.target.value})}
                                        className="w-full px-4 py-2 border rounded-lg"
                                    >
                                        <option value="blue">Blue</option>
                                        <option value="purple">Purple</option>
                                        <option value="green">Green</option>
                                        <option value="red">Red</option>
                                        <option value="orange">Orange</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold mb-2">Currency Symbol</label>
                                    <select
                                        value={branding.currency}
                                        onChange={(e) => setBranding({...branding, currency: e.target.value})}
                                        className="w-full px-4 py-2 border rounded-lg"
                                    >
                                        <option value="‚Ç¶">‚Ç¶ Naira (NGN)</option>
                                        <option value="$">$ Dollar (USD)</option>
                                        <option value="‚Ç¨">‚Ç¨ Euro (EUR)</option>
                                        <option value="¬£">¬£ Pound (GBP)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* Pricing Display */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-xl font-bold mb-4">Current Pricing</h3>
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                {Object.entries(PRICING).map(([tier, details]) => (
                                    <div key={tier} className="border rounded-lg p-4">
                                        <h4 className="font-bold mb-2">{tier}</h4>
                                        <p className="text-2xl font-bold text-blue-600 mb-2">
                                            {branding.currency}{details.amount.toLocaleString()}
                                            {details.amount > 0 && <span className="text-sm text-gray-600">/mo</span>}
                                        </p>
                                        <p className="text-xs text-gray-600">
                                            {details.jobs === -1 ? 'Unlimited' : details.jobs} jobs
                                        </p>
                                        <p className="text-xs text-gray-600">
                                            {details.candidates === -1 ? 'Unlimited' : details.candidates} candidates
                                        </p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // Mobile-friendly Navigation
            const Navigation = () => (
                <nav className="bg-white shadow-sm border-b sticky top-0 z-50">
                    <div className="px-4 sm:px-6 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <BriefcaseIcon />
                                <h1 className="text-xl sm:text-2xl font-bold gradient-text">{branding.name}</h1>
                            </div>
                            
                            {/* Mobile Menu Button */}
                            <button
                                onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                                className="sm:hidden p-2 hover:bg-gray-100 rounded-lg"
                            >
                                <MenuIcon />
                            </button>

                            {/* Desktop Navigation */}
                            <div className="hidden sm:flex gap-2">
                                <NavButton label="Dashboard" view="dashboard" icon={<ChartIcon />} />
                                <NavButton label="Jobs" view="jobs" icon={<BriefcaseIcon />} />
                                <NavButton label="Candidates" view="candidates" />
                                <NavButton label="Emails" view="emails" icon={<MailIcon />} />
                                <NavButton label="Videos" view="videos" icon={<VideoIcon />} />
                                <NavButton label="Apply" view="apply" />
                                <NavButton label="Settings" view="settings" />
                            </div>
                        </div>

                        {/* Mobile Menu */}
                        {mobileMenuOpen && (
                            <div className="sm:hidden mt-4 pb-4 space-y-2">
                                <MobileNavButton label="Dashboard" view="dashboard" />
                                <MobileNavButton label="Jobs" view="jobs" />
                                <MobileNavButton label="Candidates" view="candidates" />
                                <MobileNavButton label="Emails" view="emails" />
                                <MobileNavButton label="Videos" view="videos" />
                                <MobileNavButton label="Apply" view="apply" />
                                <MobileNavButton label="Settings" view="settings" />
                            </div>
                        )}
                    </div>
                </nav>
            );

            const NavButton = ({ label, view: targetView, icon }) => (
                <button
                    onClick={() => setView(targetView)}
                    className={`px-3 py-2 rounded-lg transition flex items-center gap-2 text-sm ${
                        view === targetView
                            ? 'bg-blue-600 text-white'
                            : 'text-gray-600 hover:bg-gray-100'
                    }`}
                >
                    {icon}
                    <span className="hidden md:inline">{label}</span>
                </button>
            );

            const MobileNavButton = ({ label, view: targetView }) => (
                <button
                    onClick={() => {
                        setView(targetView);
                        setMobileMenuOpen(false);
                    }}
                    className={`w-full text-left px-4 py-3 rounded-lg transition ${
                        view === targetView
                            ? 'bg-blue-600 text-white'
                            : 'bg-gray-50 text-gray-700 hover:bg-gray-100'
                    }`}
                >
                    {label}
                </button>
            );

            return (
                <div className="min-h-screen bg-gray-50">
                    <Navigation />
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 py-6">
                        {view === 'dashboard' && <EnhancedDashboard />}
                        {view === 'emails' && <EmailManagement />}
                        {view === 'videos' && <VideoInterviewView />}
                        {view === 'settings' && <SettingsView />}
                        {view === 'jobs' && <div><h2 className="text-2xl font-bold">Jobs (Use previous Jobs component)</h2></div>}
                        {view === 'candidates' && <div><h2 className="text-2xl font-bold">Candidates (Use previous Candidates component)</h2></div>}
                        {view === 'apply' && <div><h2 className="text-2xl font-bold">Apply (Use previous Apply component)</h2></div>}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
